<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\BlingPoint.Framework.js - BlingPoint</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="BlingPoint"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Framework.html">Framework</a></li>
            
                <li><a href="../modules/Global.html">Global</a></li>
            
                <li><a href="../modules/Loader.html">Loader</a></li>
            
                <li><a href="../modules/Log.html">Log</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\BlingPoint.Framework.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * BlingPoint Framework Module
 * @module Framework
 */
var ctx;
var web;
var user;

( function() {
	
	var BLINGPOINT_ROOT_NAMESPACE = &#x27;blingpoint&#x27;;
	var BLINGPOINT_PLUGINS_NAMESPACE = &#x27;plugins&#x27;;
	var BLINGPOINT_SCHEMA_NAMESPACE = &#x27;schema&#x27;;
	var BLINGPOINT_SECURITY_NAMESPACE = &#x27;security&#x27;;
	var BLINGPOINT_PARAMETERS_NAMESPACE = &#x27;parameters&#x27;;
	var BLINGPOINT_UI_NAMESPACE = &#x27;ui&#x27;;
	var BLINGPOINT_SITES_NAMESPACE = &#x27;sites&#x27;;
	var BLINGPOINT_LISTS_NAMESPACE = &#x27;lists&#x27;;
	var BLINGPOINT_ITEMS_NAMESPACE = &#x27;items&#x27;;
	
	// Init namespaces
	window[ BLINGPOINT_PLUGINS_NAMESPACE ] = {};
	window[ BLINGPOINT_SCHEMA_NAMESPACE ] = {};
	window[ BLINGPOINT_SECURITY_NAMESPACE]  = {};
	window[ BLINGPOINT_PARAMETERS_NAMESPACE]  = {};
	window[ BLINGPOINT_UI_NAMESPACE ] = {};
	window[ BLINGPOINT_SITES_NAMESPACE ] = {};
	window[ BLINGPOINT_LISTS_NAMESPACE ] = {};
	window[ BLINGPOINT_ITEMS_NAMESPACE ] = {};

	
	
	// Initialize blingpoint framework common objects
	function InitWeb() {

		ctx = SP.ClientContext.get_current();
		web = ctx.get_web();
		ctx.load(web);
		user = ctx.get_web().get_currentUser();
		ctx.load(user);

		ctx.executeQueryAsync(
			function() {
				log.info(&#x27;Web Context loaded&#x27;);
				log.debug(&#x27;web title:&#x27; + web.get_title());
				log.debug(&#x27;Description:&#x27; + web.get_description());
				log.debug(&#x27;ID:&#x27; + web.get_id());
				log.debug(&#x27;Created Date:&#x27; + web.get_created());
				log.debug(&#x27;Web Url:&#x27; + web.get_serverRelativeUrl());
				log.info(&#x27;Current user loaded&#x27;);
				log.debug(&#x27;ID:&#x27; + user.get_id());
				log.debug(&#x27;User title:&#x27; + user.get_title());
				log.debug(&#x27;Email:&#x27; + user.get_email());
				blingpoint.plugins.loadPlugIns();
			},
			function (sender, args) {
				blingpoint.log.error(&#x27;request failed &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
			}
		);

	}

	ExecuteOrDelayUntilScriptLoaded(InitWeb,&quot;sp.js&quot;);




	function CreateField (fieldType, fieldName, fieldDisplayName, fieldGroup, fieldHidden, callBackFunctionOnSuccess, callBackFunctionOnError) {

        var fields = web.get_fields();
 
        var fieldXml = &quot;&lt;Field Type=&#x27;&quot; + fieldType + &quot;&#x27; DisplayName=&#x27;&quot; + fieldDisplayName + &quot;&#x27; Name=&#x27;&quot; + fieldName + 
            &quot;&#x27; Group=&#x27;&quot; + fieldGroup + &quot;&#x27; Hidden=&#x27;&quot; + fieldHidden + &quot;&#x27;&gt;&lt;/Field&gt;&quot;;
 
        /*
		Text, Number, DateTime, Note, HTML, Image, URL, Boolean, Choice, MultiChoice, Lookup, LookupMulti

		Sharepoint Field Types - Elements.xml
		Single Line of Text:
		field id=&quot;{FDDC4E38-25E0-4FD9-92E7-D17F34A5AB12}&quot; description=&quot;My Content ID of Item&quot; staticname=&quot;ContentID&quot; name=&quot;ContentID&quot; displayname=&quot;ContentID&quot; type=&quot;Text&quot; group=&quot;Sample Site Columns&quot; sourceid=&quot;http://schemas.microsoft.com/sharepoint/v3&quot;

		Number:
		Field ID=&quot;{13b3652a-d543-465d-91cb-a9d625637855}&quot; StaticName=&quot;Read_Times&quot; Name =&quot;Read_Times&quot; DisplayName =&quot;Read_Times&quot; Description=&quot;Read Time count of Item&quot; Type=&quot;Number&quot; Group =&quot;Sample Site Columns&quot; SourceID =&quot;http://schemas.microsoft.com/sharepoint/v3&quot;

		Date Time:
		Field ID=&quot;{d076e4d5-c785-4c04-8b56-c1f021721749}&quot; StaticName=&quot;CreateDate&quot; Name=&quot;CreateDate&quot; DisplayName=&quot;Create_Date&quot; Description=&quot;Create Date of Item&quot; Group=&quot;Sample Site Columns&quot; Type=&quot;DateTime&quot; Format=&quot;DateOnly&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot;

		Multiple lines of text:
		Field ID=&quot;{2ae59f08-0fb0-4a9c-8a31-a180161b1029}&quot; StaticName=&quot;PublisherDescription&quot; Name=&quot;PublisherDescription&quot; Description=&quot;Publisher Description of Item&quot; DisplayName=&quot;Publisher_Description&quot; Type=&quot;Note&quot; RichText=&quot;FALSE&quot; NumLines=&quot;6&quot; Group=&quot;Sample Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot;

		Rich Text HTML:
		Field ID=&quot;{13cd0291-df15-4278-9894-630913e4d2b9}&quot; StaticName=&quot;AccrediterDescription&quot; Name=&quot;AccrediterDescription&quot; DisplayName=&quot;Accrediter_Description&quot; Description=&quot;Accrediter Description of Item&quot; Type=&quot;Note&quot; NumLines=&quot;6&quot; RichText=&quot;TRUE&quot; RichTextMode=&quot;FullHtml&quot; Group=&quot;Sample Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot;

		Publishing HTML:
		Field ID=&quot;{E2CC0231-FA6C-4F90-839C-118C304DFCF1}&quot; StaticName=&quot;PMediaDescription&quot; Name=&quot;PMediaDescription&quot; DisplayName=&quot;MediaDescription&quot; Type=&quot;HTML&quot; RichText=&quot;TRUE&quot; RichTextMode=&quot;ThemeHtml&quot; Group=&quot;Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3&quot; UnlimitedLengthInDocumentLibrary =&quot;TRUE&quot;

		Publishing Image:
		field id=&quot;{148e8191-afe7-4422-b1d1-7202eda667f1}&quot; description=&quot;Image 1 link of Item&quot; staticname=&quot;PImageID1&quot; name=&quot;PImageID1&quot; displayname=&quot;Image_ID1&quot; type=&quot;Image&quot; group=&quot;My Site Columns&quot; sourceid=&quot;http://schemas.microsoft.com/sharepoint/v3&quot; richtext=&quot;TRUE&quot; richtextmode=&quot;ThemeHtml&quot;&gt;


		HyperLink &amp; Image:
		Field ID=&quot;{635a2031-2088-4413-b54e-d2af5daf08bf}&quot; StaticName=&quot;ImageAuthor&quot; Name=&quot;ImageAuthor&quot; DisplayName=&quot;Image_Author&quot; Description=&quot;Author Image&quot; Type=&quot;URL&quot; Format=&quot;Image&quot; Group=&quot;Sample Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot;


		YES/No Boolean:
		&lt;Field ID=&quot;{11018312-58f9-4eb0-867d-71298f82d98d}&quot; Name=&quot;isActive&quot; StaticName=&quot;isActive&quot; DisplayName=&quot;isActive&quot; Description=&quot;Select if Item is Active&quot; Group=&quot;Sample Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3&quot; Type=&quot;Boolean&quot;&amp;gt;
		&lt;default&gt;0&lt;/default&gt;
		&lt;/FIELD&gt;

		CHOICES:
		&lt;Field ID=&quot;{67f8faa4-e3ee-44bf-a3b4-6e7fc9c6b9fe}&quot; Name=&quot;Market&quot; StaticName=&quot;Market&quot; DisplayName=&quot;Market&quot; Description=&quot;Market of the Country&quot; Group=&quot;Sample Site Columns&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3&quot; Type=&quot;Choice&quot;&amp;gt;
		&lt;choices&gt;
		choice&gt;Gold&lt;/choice
		&lt;/choices&gt;
		&lt;/FIELD&gt;

		MultiSelect:
		&lt;Field Type=&quot;MultiChoice&quot; DisplayName=&quot;Labels_Selected&quot; FillInChoice=&quot;FALSE&quot; Group=&quot;Sample Site Columns&quot; ID=&quot;{2fdf0ba7-0052-4e9f-80f6-e7669ac4ae4f}&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3&quot; StaticName=&quot;LabelsSelected&quot; Name=&quot;LabelsSelected&quot;&amp;gt;
		&lt;/FIELD&gt;

		Lookup Columns:
		Field Type=&quot;Lookup&quot; ID=&quot;{FE45AC76-C0E2-46C8-A047-E8C43C10315C}&quot; Name=&quot;LU_Country&quot; StaticName=&quot;LU_Country&quot; DisplayName=&quot;LU_Country&quot; Required=&quot;FALSE&quot; List=&quot;Lists/Region Country Master&quot; ShowField=&quot;RollOutCountry&quot; UnlimitedLengthInDocumentLibrary=&quot;FALSE&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot; Group=&quot;Sample Site Columns&quot;

		Multi Lookup Columns:
		Field Type=&quot;LookupMulti&quot; Mult=&quot;TRUE&quot; ID=&quot;{85062ACF-315B-460A-B756-2230A5FE082F}&quot; Name=&quot;LU_Language&quot; StaticName=&quot;LU_Language&quot; DisplayName=&quot;LU_Language&quot; Required=&quot;FALSE&quot; List=&quot;Lists/Language Master&quot; ShowField=&quot;Title&quot; UnlimitedLengthInDocumentLibrary=&quot;FALSE&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot; Group=&quot;Sample Site Columns&quot;

		Lookup with Additional Field Lookup column:
		Field Type=&quot;Lookup&quot; ID=&quot;{9AA2985D-AA17-4EA2-9556-9B0E112A64F6}&quot; Name=&quot;LU_ApplicationType&quot; StaticName=&quot;LU_ApplicationType&quot; DisplayName=&quot;LU_ApplicationType&quot; Required=&quot;FALSE&quot; List=&quot;Lists/Application Type&quot; ShowField=&quot;ApplicationType&quot; UnlimitedLengthInDocumentLibrary=&quot;FALSE&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot; Group=&quot;Sample Site Columns&quot;

		Field Type=&quot;Lookup&quot; ID=&quot;{668D51C4-804D-43E7-8211-950AE3BCD9A3}&quot; Name=&quot;LU_ApplicationType_ID&quot; StaticName=&quot;LU_ApplicationType_ID&quot; DisplayName=&quot;LU_ApplicationType_ID&quot; List=&quot;Lists/Application Type&quot; ShowField=&quot;ApplicationTypeID&quot; FieldRef=&quot;9AA2985D-AA17-4EA2-9556-9B0E112A64F6&quot; ReadOnly=&quot;TRUE&quot; UnlimitedLengthInDocumentLibrary=&quot;FALSE&quot; SourceID=&quot;http://schemas.microsoft.com/sharepoint/v3/fields&quot; Group=&quot;Sample Site Columns&quot;

        */


		var createdField = fields.addFieldAsXml(fieldXml, false, SP.AddFieldOptions.AddToNoContentType);

		ctx.load(fields);
		ctx.load(createdField);
		ctx.executeQueryAsync(
			function(){
				blingpoint.log.debug(&#x27;Field provisioned in host web successfully.&#x27;);
				callBackFunctionOnSuccess();
			},
			function (sender, args){
				blingpoint.log.warn(&#x27;Failed to provision field into host web. Error:&#x27; + sender.statusCode);
				callBackFunctionOnError();
			}
		);
	}


	function CreateContentTypeInHost (ctypeName, ctypeDescription, ctypeGroup, callBackFunctionOnSuccess, callBackFunctionOnError) {
		hostWebContentTypes = web.get_contentTypes();
		var cTypeInfo = new SP.ContentTypeCreationInformation();
		cTypeInfo.set_name(ctypeName);
		cTypeInfo.set_description(ctypeDescription);
		cTypeInfo.set_group(ctypeGroup);
		hostWebContentTypes.add(cTypeInfo);
		ctx.load(hostWebContentTypes);
		ctx.executeQueryAsync(
			function(){
				blingpoint.log.debug(&#x27;Content type provisioned in host web successfully.&#x27;);
				callBackFunctionOnSuccess();
			},
			function (sender, args){
				blingpoint.log.warn(&#x27;Failed to provision content type into host web. Error:&#x27; + sender.statusCode);
				callBackFunctionOnError();
			}
		);
	}


	function AddFieldToContentTypeInHost (ctypeName, fieldInternalName, callBackFunctionOnSuccess, callBackFunctionOnError) {

		createdFieldInternalName = fieldInternalName;
		createdContentTypeName = ctypeName;

		// re-fetch created items..
		createdField = web.get_fields().getByInternalNameOrTitle(fieldInternalName);
		ctx.load(createdField);

		hostWebContentTypes = web.get_contentTypes();
		ctx.load(hostWebContentTypes);

		ctx.executeQueryAsync(
			function() {
				performAddFieldToContentTypeInHost(createdContentTypeName, createdFieldInternalName, callBackFunctionOnSuccess, callBackFunctionOnError);
			},
			function (sender, args) {
				blingpoint.log.warn(&#x27;Failed to re-fetch field and content type. Error:&#x27; + sender.statusCode);
				callBackFunctionOnError();
			}
		);

	}

    function performAddFieldToContentTypeInHost (ctypeName, fieldInternalName, callBackFunctionOnSuccess, callBackFunctionOnError) {
        // iterate content types, find passed one, THEN add field..
        var cTypeFound = false;
        var createdContentType;

        var contentTypeEnumerator = hostWebContentTypes.getEnumerator();
        while (contentTypeEnumerator.moveNext()) {
            var contentType = contentTypeEnumerator.get_current();
            if (contentType.get_name() === ctypeName) {
                cTypeFound = true;
                createdContentType = contentType;
                break;
            }
        }

		if (cTypeFound) {
			// - NOT the below line - SP.FieldCollection doesn&#x27;t appear to have an add() method when fetched from content type..
			//contentType.get_fields.add(fieldInternalName)
			// - instead, this..
			var fieldRef = new SP.FieldLinkCreationInformation();
			fieldRef.set_field(createdField);

			createdContentType.get_fieldLinks().add(fieldRef);
			// specify push down..
			createdContentType.update(true);

			ctx.load(createdContentType);
			ctx.executeQueryAsync(
				function () {
					blingpoint.log.debug(&#x27;Field added to content type in host web successfully.&#x27;);
					callBackFunctionOnSuccess();
				},
				function (sender, args) {
					blingpoint.log.warn(&#x27;Failed to add field to content type. Error:&#x27; + sender.statusCode);
					callBackFunctionOnError();
				}
			);
		}
		else {
			blingpoint.log.warn(&#x27;Failed to add field to content type - check the content type exists!&#x27;);
			callBackFunctionOnError();
		}
    }


	function AddExistingContentTypetoList(listName, contentTypeName, callBackFunctionOnSuccess, callBackFunctionOnError) {
        
        var contentTypeCollection;
        var contentType;
        var listCollection;
        var list;
        var listContentTypeColl;

        var clientContext = ctx;
        
        // Retrieve content type by name
        hostWebContentTypes = web.get_contentTypes();
		ctx.load(hostWebContentTypes);

		ctx.executeQueryAsync(
			function() {
				var contentTypeEnumerator = hostWebContentTypes.getEnumerator();
				while (contentTypeEnumerator.moveNext()) {
					var contentType = contentTypeEnumerator.get_current();
					if (contentType.get_name() === contentTypeName) {
						performAddExistingContentTypetoList(listName, contentType, callBackFunctionOnSuccess, callBackFunctionOnError);
					}
				}
			},
			function (sender, args) {
				blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
				callBackFunctionOnError();
			}
		);
	} 


	function performAddExistingContentTypetoList(listName, contentType, callBackFunctionOnSuccess, callBackFunctionOnError) {
		listCollection = web.get_lists();
		list = listCollection.getByTitle(listName);
		listContentTypeColl = list.get_contentTypes();
		listContentTypeColl.addExistingContentType(contentType);
		ctx.load(listContentTypeColl);
		ctx.executeQueryAsync(
			function () {
				blingpoint.log.debug(&#x27;Content Type added successfully&#x27;);
				callBackFunctionOnSuccess();
			},
			function (sender, args) {
				blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
				callBackFunctionOnError();
			}
		);
	}



	function IsUserMemberOf(groupIdOrName, callbackFunctionIfMember, callbackFunctionIfNotMember) {

		var collGroup = web.get_siteGroups();
		ctx.load(collGroup);

		ctx.executeQueryAsync(

			function (sender, args) {

				var oGroup;
				if (blingpoint.global.isNumber(groupIdOrName)) {
					oGroup = collGroup.getById(groupIdOrName);
				}
				else {
					oGroup = collGroup.getByName(groupIdOrName);
				}

				var collUser = oGroup.get_users();
				ctx.load(collUser);
				ctx.executeQueryAsync(

					function (sender, args) {
						var userEnumerator = collUser.getEnumerator();
						while (userEnumerator.moveNext()) {
							var oUser = userEnumerator.get_current();
							if (oUser.get_id() == user.get_id()) {
								
								callbackFunctionIfMember();
								return;

							}
						}
						callbackFunctionIfNotMember();
						return;	

					}, 
					function (sender, args) {
						blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
					}
				);
			},

			function (sender, args) {
				blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
			}
		);
	}





	/*-------------------------------------------------------------
		Parameters
	-------------------------------------------------------------*/

	function SetWebSiteProperty(property, propertyValue) {

		var props = web.get_allProperties();

		props.set_item(property, propertyValue);
		web.update();

		ctx.executeQueryAsync(
			function (sender, args) {
				blingpoint.log.debug(&#x27;WebSite property &#x27; + property + &#x27; = &#x27; + propertyValue);
			},
			function (sender, args) {
				blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
			}
		);
	}
 
 
	function GetWebSiteProperty(property, callBackFunction) {

		var props = web.get_allProperties();
		var propertyValue = props.get_item(property);

		ctx.executeQueryAsync(
			function (sender, args) {
				callBackFunction(propertyValue);
			},
			function (sender, args) {
				blingpoint.log.warn(&#x27;Request failed. &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
			}
		);
	}
 



	/*-------------------------------------------------------------
	PlugIns
	-------------------------------------------------------------*/
	function SetupPlugInSystem() {

		function provisionBlingPointPlugInSystem() {
			createBlingPointPlugInList();
		}
		function createBlingPointPlugInList() {
			$p.lists.createList(&#x27;BlingPointPlugIns&#x27;, SP.ListTemplateType.genericList, false, createBlingPointPlugInContentType, null);	
		}
		function createBlingPointPlugInContentType() {
			$p.schema.createContentTypeInHost(&#x27;BlingPointPlugIn&#x27;, &#x27;BlingPoint PlugIn&#x27;, &#x27;BlingPointContentTypes&#x27;, createBlingPointPlugInDescriptionField, null);
		}
		function createBlingPointPlugInDescriptionField() {
			$p.schema.createField(&#x27;Text&#x27;, &#x27;PlugInDescription&#x27;, &#x27;PlugIn Description&#x27;, &#x27;BlingPointFields&#x27;, false, createBlingPointPlugInUrlTriggerField, null);
		}
		function createBlingPointPlugInUrlTriggerField() {
			$p.schema.createField(&#x27;Text&#x27;, &#x27;PlugInUrlTrigger&#x27;, &#x27;PlugIn URL Trigger&#x27;, &#x27;BlingPointFields&#x27;, false, createBlingPointPlugInSourceUrlField, null);
		}
		function createBlingPointPlugInSourceUrlField() {
			$p.schema.createField(&#x27;Text&#x27;, &#x27;PlugInSourceUrl&#x27;, &#x27;PlugIn Source URL&#x27;, &#x27;BlingPointFields&#x27;, false, addBlingPointPlugInDescriptionField, null);
		}
		function addBlingPointPlugInDescriptionField() {
			$p.schema.addFieldToContentTypeInHost(&#x27;BlingPointPlugIn&#x27;, &#x27;PlugInDescription&#x27;, addBlingPointPlugInUrlTriggerField, null);
		}
		function addBlingPointPlugInUrlTriggerField() {
			$p.schema.addFieldToContentTypeInHost(&#x27;BlingPointPlugIn&#x27;, &#x27;PlugInUrlTrigger&#x27;,addBlingPointPlugInSourceUrlField, null);
		}
		function addBlingPointPlugInSourceUrlField() {
			$p.schema.addFieldToContentTypeInHost(&#x27;BlingPointPlugIn&#x27;, &#x27;PlugInSourceUrl&#x27;, addBlingPointPlugInContentTypeToList, null);
		}
		function addBlingPointPlugInContentTypeToList() {
			$p.schema.addExistingContentTypetoList(&#x27;BlingPointPlugIns&#x27;, &#x27;BlingPointPlugIn&#x27;, null, null);
		}
		provisionBlingPointPlugInSystem();
	}

	function LoadPlugIns() {

		var list = web.get_lists().getByTitle(&quot;BlingPointPlugIns&quot;);
		var camlQuery = new SP.CamlQuery();
		var q = &#x27;&lt;View&gt;&lt;RowLimit&gt;500&lt;/RowLimit&gt;&lt;/View&gt;&#x27;;

		camlQuery.set_viewXml(q);
		var oListItems = list.getItems(camlQuery);

		ctx.load(oListItems, &#x27;Include(DisplayName,Id,PlugInSource,UrlTrigger)&#x27;);

		ctx.executeQueryAsync(
			function(){
				var oListEnumerator = oListItems.getEnumerator();
				//iterate though all of the items
				while (oListEnumerator.moveNext()) {
					var item = oListEnumerator.get_current();
					var title = item.get_displayName();
					var id = item.get_id();
					// If its an URL field, add &quot;.get_url()&quot;
					var plugInSource = item.get_item(&#x27;PlugInSource&#x27;);
					var urlTrigger = item.get_item(&#x27;UrlTrigger&#x27;);

					log.debug(&quot;Checking PlugIn : &quot; + title);
					log.debug(&quot;PlugIn ID : &quot; + id);
					log.debug(&quot;PlugIn URL Trigger : &quot; + urlTrigger);

					if (blingpoint.global.checkUrl(urlTrigger)) {
						if (blingpoint.global.check(plugInSource,&quot;.js&quot;)) {
							log.info(&quot;Loading PlugIn : &quot; + title);
							blingpoint.loader.addScriptToPage(plugInSource);
						}
						if (blingpoint.global.check(plugInSource,&quot;.css&quot;)) {
							log.info(&quot;Loading PlugIn : &quot; + title);
							blingpoint.loader.addCssToPage(plugInSource);
						}
					}

				}
			}, 
			function(sender, args){
				blingpoint.log.error(&#x27;request failed &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
				blingpoint.log.error(&#x27;If the list BlingPointPlugIns does not exist, &lt;a href=&quot;javascript:$p.plugins.setupPlugInSystem();&quot;&gt;click here to setup BlingPoint !&lt;/a&gt;&#x27;);
			}
		);
	}	


	/*-------------------------------------------------------------
	UI
	-------------------------------------------------------------*/
	function AddNotification(htmlMessage,sticky) {
		ExecuteOrDelayUntilScriptLoaded(function(){
			notificationId = SP.UI.Notify.addNotification(htmlMessage, sticky);
			log.debug(notificationId);
			return notificationId;
		},
		&quot;sp.js&quot;
		);  
	}

	function RemoveNotification(notificationId) {
		SP.UI.Notify.removeNotification(notificationId);
	}	

	function AddStatus(htmlMessage,color) {
		statusId = SP.UI.Status.addStatus(htmlMessage);
		SP.UI.Status.setStatusPriColor(statusId, color);
		log.debug(statusId);
		return statusId;
	}

	function RemoveStatus(statusId) {
		SP.UI.Status.removeStatus(statusId);
	}

	function RemoveAllStatus() {
		SP.UI.Status.removeAllStatus(true);
	}

	//Dialog opening 
	function OpenDialog(dialogUrl, dialogWidth, dialogHeight) { 

		ExecuteOrDelayUntilScriptLoaded(

			function() {
				
				var options = SP.UI.$create_DialogOptions(); 
				options.url = dialogUrl; 
				options.width = dialogWidth; 
				options.height = dialogHeight;
				//options.dialogReturnValueCallback = Function.createDelegate(this, this.onOpenDialogCallback); 
				options.dialogReturnValueCallback = function (result, target) { 
					if(result === SP.UI.DialogResult.OK) { 
						console.log(&quot;OK was clicked!&quot;); 
						blingpoint.ui.addNotification(&#x27;New leave application request submitted&#x27;,false);
					} 
					if(result === SP.UI.DialogResult.cancel) { 
						console.log(&quot;Cancel was clicked!&quot;); 
					} 
				};
				
				var dialog = SP.UI.ModalDialog.showModalDialog(options);
				
				//log.info(dialog.get_frameElement().id);
				
				//dialog.get_frameElement().contentWindow.document.write(&#x27;&lt;html&gt;&lt;body&gt;Hello World&lt;script&gt;alert(&quot;coucou&quot;);&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;&#x27;);
				//log.info(dialog.get_frameElement().contentWindow.document.body.innerHTML);
				//log.info(dialog.get_frameElement().contentWindow.document.body.innerText);
			},
			&quot;sp.js&quot;
		);
	}


	/*-------------------------------------------------------------
		Sites
	-------------------------------------------------------------*/
	function CreateSite(siteTitle, siteDescription, siteUrl, siteLanguage, siteTemplate, inheritsPermissions, callBackFunction) {

	// siteLanguage : http://technet.microsoft.com/en-us/library/ff463597.aspx
	// siteTemplate : https://www.nothingbutsharepoint.com/sites/devwiki/SP2010Dev/Pages/Site%20Templates%20in%20SharePoint%202010.aspx
	// Exemple : czaCreateSite(&#x27;monblog&#x27;,&#x27;madesc&#x27;,&#x27;blog1&#x27;,1033, &#x27;BLOG#0&#x27;, true);
	// Blank : STS#1
	
	ExecuteOrDelayUntilScriptLoaded(
		
		function() {

			var webCreateInfo = new SP.WebCreationInformation();
			webCreateInfo.set_title(siteTitle);
			webCreateInfo.set_description(siteDescription);
			webCreateInfo.set_url(siteUrl);
			webCreateInfo.set_language(siteLanguage);
			webCreateInfo.set_webTemplate(siteTemplate);
			webCreateInfo.set_useSamePermissionsAsParentSite(inheritsPermissions);

			oNewWebsite = web.get_webs().add(webCreateInfo);

				// Charger dans le load les propriétés à initialiser
				//clientContext.load(this.oNewWebsite,&#x27;Title&#x27;, &#x27;Created&#x27;,&#x27;ServerRelativeUrl&#x27;);

				ctx.load(oNewWebsite);

				ctx.executeQueryAsync(

					function (sender, args) {
						
						var createdSiteUrl;
						
						createdSiteUrl = oNewWebsite.get_serverRelativeUrl();
						
						log.info(&#x27;Site Created&#x27;);
						log.debug(&#x27;Site Url : &#x27; + createdSiteUrl);

						callBackFunction(createdSiteUrl);
						
					},

					function (sender, args) {
						log.warn(&#x27;Site creation failed : &#x27; + args.get_message() + &#x27;\n&#x27; + args.get_stackTrace());
					}

					);
				
			},
			&quot;sp.js&quot;
			);  
	}

	/*-------------------------------------------------------------
	Lists
	-------------------------------------------------------------*/
	function CreateList(listName, listTemplate, displayInQuickLaunch, callBackFunctionOnSuccess, callBackFunctionOnError) {

		//Let&#x27;s create list creation information object 
		var listCreationInfo = new SP.ListCreationInformation(); 

		// Nom de la liste
		listCreationInfo.set_title(listName);
		
		/*
		Définition du type
		// Référence : http://msdn.microsoft.com/en-us/library/jj245053.aspx
		*/
		if (listTemplate !== null) {
			listCreationInfo.set_templateType(listTemplate);
		}
		else {
			listCreationInfo.set_templateType(SP.ListTemplateType.genericList); 
		}
		
		// Affichage dans le QuickLaunch
		// Référence : http://msdn.microsoft.com/en-us/library/ee556266.aspx
		switch (displayInQuickLaunch) {
			case true:
			listCreationInfo.set_quickLaunchOption(SP.QuickLaunchOptions.on); 
			break;
			case false:
			listCreationInfo.set_quickLaunchOption(SP.QuickLaunchOptions.off); 
			break;
			default:
			listCreationInfo.set_quickLaunchOption(SP.QuickLaunchOptions.off); 
			break;
		}

		// Création de la liste
		var oList = web.get_lists().add(listCreationInfo); 
		
		ctx.load(oList);
	
		//Execute the actual script 
		ctx.executeQueryAsync(
			function(){
				blingpoint.log.info(&quot;List &lt;b&gt;&quot; + oList.get_title() + &quot;&lt;/b&gt; created...&quot;, false);
				callBackFunctionOnSuccess();
			},
			function (sender, args){
				handleManagedError(&quot;Operation was cancelled...&quot;, sender, args);
				blingpoint.log.warn(&quot;List creation operation was cancelled...&quot;, false);
				callBackFunctionOnError();
			}
		); 

	}
	
	
	/*-------------------------------------------------------------
	Items
	-------------------------------------------------------------*/
	function CreateItem(listName, itemTitle, callBackFunction) {

		//Retrieve the lists
		var lists = web.get_lists();
		//Get the Cars List
		var list = lists.getByTitle(listName);
		//Create new IteamCreationInformation
		var itemCreationInfo = new SP.ListItemCreationInformation();
		//the addItem takes the itemCreationInformation object
		//and returns the listItem
		var listItem = list.addItem(itemCreationInfo);
		//Set the title of the list Item
		//to the value in the txtCar
		listItem.set_item(&#x27;Title&#x27;, itemTitle);
		//Call Update the listItem
		listItem.update();
		//Finally execute the operation

		ctx.executeQueryAsync(
			function () {

				var createdItemId;
				
				createdItemId = listItem.get_id();
				blingpoint.log.debug(createdItemId);
				//blingpoint.items.lastCreatedItemId = listItem.get_id();
				blingpoint.ui.addNotification(&#x27;created&#x27;, false);
				
				callBackFunction(createdItemId);
				
			},
			function (sender, args) {
				blingpoint.global.handleManagedError(&quot;Operation was cancelled...&quot;, sender, args);
				blingpoint.log.debug(&#x27;Error&#x27;);
				blingpoint.ui.addNotification(&quot;Operation was cancelled...&quot;, false);
			}
		);
	}

	function UpdateItem(listName, itemId, column, value, callBackFunction) {

		ExecuteOrDelayUntilScriptLoaded(function(){

			var list = web.get_lists().getByTitle(listName);
			var oListItem = list.getItemById(itemId);
			
			/*-------------------------------------------------------------
			Use user ID for the value param for people fields
			
			Date : Use a Date object (eg : var now = new Date(); )
			
			Use this snippet for lookupf fields :
			var _newLookupField = new SP.FieldLookupValue();
			newLookupField.set_lookupId(10) -&gt; Updated with some lookup value for Department column
			currentItem.set_item(‘Department’, newLookupField);
			currentItem.update();
			// Call context.executeQueryAsync again
			-------------------------------------------------------------*/
			
			/*
			Field  – How to Get\set it
			Title – SP.ListItem.get_item(‘Title‘);
			ID – SP.ListItem.get_id();
			Url -SP.ListItem.get_item(‘urlfieldname‘).get_url()
			Description – SP.ListItem.get_item(‘descriptionfieldname‘).get_description();
			Current Version – SP.ListItem.get_item(“_UIVersionString“);
			Lookup field – SP.ListItem.get_item(‘LookupFieldName’).get_lookupValue();
			Choice Field – SP.ListItem.get_item(‘ChoiceFieldName‘);
			Created Date – SP.ListItem.get_item(“Created“);
			Modified Date – SP.ListItem.get_item(“Modified“); -&gt; case sensitive does not work with ‘modified’
			Created By – SP.ListItem.get_item(“Author“).get_lookupValue());
			Modified by – SP.ListItem.get_item(“Editor“).get_lookupValue());
			File  – SP.ListItem.get_file();
			File Versions -  File.get_versions();.
			Content Type – SP.ListItem.get_contentType();
			Parent List – SP.ListItem.get_parentList();
			*/		

			//ctx.load(oListItem);
			oListItem.set_item(column, value);
			oListItem.update();
			
			ctx.executeQueryAsync(
				function () {
					blingpoint.log.debug(&#x27;Updated&#x27;);
					//blingpoint.ui.addNotification(&quot;updated&quot;, false);
					
					callBackFunction();
					
				},
				function (sender, args) {
					blingpoint.global.handleManagedError(&quot;Operation was cancelled...&quot;, sender, args);
					blingpoint.log.debug(&#x27;Error&#x27;);
					//blingpoint.ui.addNotification(&quot;Operation was cancelled...&quot;, false);
				}
				);

		},
		&quot;sp.js&quot;
		);

	}


	function UpdateItemUrl(listName, itemId, column, description, url, callBackFunction) {
		
		ExecuteOrDelayUntilScriptLoaded(function(){
			
			var list = web.get_lists().getByTitle(listName);
			var oListItem = list.getItemById(itemId);

			// context.load(&lt;object&gt;,&#x27;&lt;Field1&gt;&#x27;,&#x27;&lt;Field2&gt;&#x27;,&#x27;&lt;Field3&gt;&#x27;);
			// context.load(&lt;objectCollection&gt;,&#x27;Include(&lt;Field1&gt;,&lt;Field2&gt;,&lt;Field3&gt;&#x27;);

			ctx.load(oListItem,column);

			ctx.executeQueryAsync(
				function () {

					var oFieldUrlValue;
					//oUrlField = oListItem.get_item(column);
					oFieldUrlValue = new SP.FieldUrlValue();
					oFieldUrlValue.set_url(url);
					oFieldUrlValue.set_description(description);
					oListItem.set_item(column, oFieldUrlValue);
					
					oListItem.update();

					ctx.executeQueryAsync(
						function () {
							log.debug(&#x27;Updated&#x27;);
							//blingpoint.ui.addNotification(&quot;updated&quot;, false);
							
							callBackFunction();
							
						},
						function (sender, args) {
							blingpoint.global.handleManagedError(&quot;Operation was cancelled...&quot;, sender, args);
							blingpoint.log.debug(&#x27;Error&#x27;);
							//blingpoint.ui.addNotification(&quot;Operation was cancelled...&quot;, false);
						}
					);

				},
				function (sender, args) {
					blingpoint.global.handleManagedError(&quot;Operation was cancelled...&quot;, sender, args);
					blingpoint.log.debug(&#x27;Error&#x27;);
					//blingpoint.ui.addNotification(&quot;Operation was cancelled...&quot;, false);
				}
			);

		},
		&quot;sp.js&quot;);
	}	



	/*-------------------------------------------------------------
	Namespaces
	-------------------------------------------------------------*/
	window[ BLINGPOINT_PLUGINS_NAMESPACE ].loadPlugIns = LoadPlugIns;
	window[ BLINGPOINT_PLUGINS_NAMESPACE ].setupPlugInSystem = SetupPlugInSystem;

	window[ BLINGPOINT_SCHEMA_NAMESPACE ].createField = CreateField;
	window[ BLINGPOINT_SCHEMA_NAMESPACE ].createContentTypeInHost = CreateContentTypeInHost;
	window[ BLINGPOINT_SCHEMA_NAMESPACE ].addFieldToContentTypeInHost = AddFieldToContentTypeInHost;
	window[ BLINGPOINT_SCHEMA_NAMESPACE ].addExistingContentTypetoList = AddExistingContentTypetoList;
	
	window[ BLINGPOINT_SECURITY_NAMESPACE ].isUserMemberOf = IsUserMemberOf;

	window[ BLINGPOINT_PARAMETERS_NAMESPACE ].setWebSiteProperty = SetWebSiteProperty;
	window[ BLINGPOINT_PARAMETERS_NAMESPACE ].getWebSiteProperty = GetWebSiteProperty;


	window[ BLINGPOINT_UI_NAMESPACE ].addStatus = AddStatus;
	window[ BLINGPOINT_UI_NAMESPACE ].removeStatus = RemoveStatus;
	window[ BLINGPOINT_UI_NAMESPACE ].removeAllStatus = RemoveAllStatus;
	window[ BLINGPOINT_UI_NAMESPACE ].addNotification = AddNotification;
	window[ BLINGPOINT_UI_NAMESPACE ].removeNotification = RemoveNotification;
	window[ BLINGPOINT_UI_NAMESPACE ].openDialog = OpenDialog;

	window[ BLINGPOINT_SITES_NAMESPACE ].createSite = CreateSite;

	window[ BLINGPOINT_LISTS_NAMESPACE ].createList = CreateList;

	window[ BLINGPOINT_ITEMS_NAMESPACE ].updateItem = UpdateItem;
	window[ BLINGPOINT_ITEMS_NAMESPACE ].updateItemUrl = UpdateItemUrl;
	window[ BLINGPOINT_ITEMS_NAMESPACE ].createItem = CreateItem;

	window[ BLINGPOINT_ROOT_NAMESPACE ].plugins = window[ BLINGPOINT_PLUGINS_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].schema = window[ BLINGPOINT_SCHEMA_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].security = window[ BLINGPOINT_SECURITY_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].parameters = window[ BLINGPOINT_PARAMETERS_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].ui = window[ BLINGPOINT_UI_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].sites = window[ BLINGPOINT_SITES_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].lists = window[ BLINGPOINT_LISTS_NAMESPACE ];
	window[ BLINGPOINT_ROOT_NAMESPACE ].items = window[ BLINGPOINT_ITEMS_NAMESPACE ];

})();

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
