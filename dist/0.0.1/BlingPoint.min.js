/*! BlingPoint 06-08-2013 */
(function(){function e(){var e=document.getElementsByTagName("script");for(i=0;e.length>i;i++){var t=e[i].src.toLowerCase().indexOf("blingpoint.js");if(t>-1)return e[i].src.substring(0,t);var n=e[i].src.toLowerCase().indexOf("blingpoint.min.js");if(n>-1)return e[i].src.substring(0,n)}}function t(e){var t=document.createElement("link");t.type="text/css",t.rel="Stylesheet",t.href=e;var n=document.head||document.getElementsByTagName("head")[0];return n.appendChild(t),!0}function n(e){var t=document.createElement("script");t.type="text/JavaScript",t.src=e,t.async=!1;var n=document.head||document.getElementsByTagName("head")[0];return n.appendChild(t),!0}var o="$p",l="$P",a="blingpoint",s="loader";window[a]={},window[s]={};var r=e(),c=r+"BlackbirdJs/blackbird.min.css";t(c),window[s].addCssToPage=t,window[s].addScriptToPage=n,window[a].loader=window[s],window[o]=window[a],window[l]=window[a]})(),function(){function generateMarkup(){var e=[];for(var t in messageTypes)e.push(['<span class="',t,'" type="',t,'"></span>'].join(""));var n=document.createElement("DIV");return n.id=IDs.blackbird,n.style.display="none",n.innerHTML=['<div class="header">','<div class="left">','<div id="',IDs.filters,'" class="filters" title="click to filter by message type">',e.join(""),"</div>","</div>",'<div class="right">','<div id="',IDs.controls,'" class="controls">','<span id="',IDs.size,'" title="contract" op="resize"></span>','<span class="clear" title="clear" op="clear"></span>','<span class="close" title="close" op="close"></span>',"</div>","</div>","</div>",'<div class="main">','<div class="left"></div><div class="mainBody">',"<ol>",cache.join(""),"</ol>",'</div><div class="right"></div>',"</div>",'<div class="footer">','<div class="left"><label for="',IDs.checkbox,'"><input type="checkbox" id="',IDs.checkbox,'" />Visible on page load</label></div>','<div class="right"></div>',"</div>"].join(""),n}function backgroundImage(){var e=document.getElementsByTagName("BODY")[0];e.currentStyle&&IE6_POSITION_FIXED&&("none"==e.currentStyle.backgroundImage&&(e.style.backgroundImage="url(about:blank)"),"scroll"==e.currentStyle.backgroundAttachment&&(e.style.backgroundAttachment="fixed"))}function addMessage(e,t){if(t=t.constructor==Array?t.join(""):t,outputList){var n=document.createElement("LI");n.className=e,n.innerHTML=['<span class="icon"></span>',t].join(""),outputList.appendChild(n),scrollToBottom()}}function clear(){outputList.innerHTML=""}function clickControl(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if("SPAN"==t.tagName)switch(t.getAttributeNode("op").nodeValue){case"resize":resize();break;case"clear":clear();break;case"close":hide()}}function clickFilter(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if(t&&"SPAN"==t.tagName){var n=t.getAttributeNode("type").nodeValue;if(e.altKey){var i=document.getElementById(IDs.filters).getElementsByTagName("SPAN"),o=0;for(var l in messageTypes)messageTypes[l]&&o++;for(var a=1==o&&messageTypes[n],s=0;i[s];s++){var r=i[s].getAttributeNode("type").nodeValue;i[s].className=a||r==n?r:r+"Disabled",messageTypes[r]=a||r==n}}else messageTypes[n]=!messageTypes[n],t.className=messageTypes[n]?n:n+"Disabled";var c=[];for(var d in messageTypes)messageTypes[d]||c.push(d);c.push(""),outputList.className=c.join("Hidden "),scrollToBottom()}}function clickVis(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;state.load=t.checked,setState()}function scrollToBottom(){outputList.scrollTop=outputList.scrollHeight}function isVisible(){return"block"==bbird.style.display}function hide(){bbird.style.display="none"}function show(){var e=document.getElementsByTagName("BODY")[0];e.removeChild(bbird),e.appendChild(bbird),bbird.style.display="block",bbird.style.zIndex="15000"}function reposition(e){switch((void 0===e||null===e)&&(e=state&&null===state.pos?1:(state.pos+1)%4),e){case 0:classes[0]="bbTopLeft";break;case 1:classes[0]="bbTopRight";break;case 2:classes[0]="bbBottomLeft";break;case 3:classes[0]="bbBottomRight"}state.pos=e,setState()}function resize(e){(void 0===e||null===e)&&(e=state&&null===state.size?0:(state.size+1)%2),classes[1]=0===e?"bbSmall":"bbLarge";var t=document.getElementById(IDs.size);t.title=1===e?"small":"large",t.className=t.title,state.size=e,setState(),scrollToBottom()}function setState(){var e=[];for(var t in state){var n=state[t]&&state[t].constructor===String?'"'+state[t]+'"':state[t];e.push(t+":"+n)}e=e.join(",");var i=new Date;i.setDate(i.getDate()+14),document.cookie=["blackbird={",e,"}; expires=",i.toUTCString(),";"].join("");var o=[];for(var l in classes)o.push(classes[l]);bbird.className=o.join(" ")}function getState(){var re=RegExp(/blackbird=({[^;]+})(;|\b|$)/),match=re.exec(document.cookie);return match&&match[1]?eval("("+match[1]+")"):{pos:null,size:null,load:null}}function readKey(e){e||(e=window.event);var t=113;if(e&&e.keyCode==t){var n=isVisible();n&&e.shiftKey&&e.altKey?clear():n&&e.shiftKey?reposition():e.shiftKey||e.altKey||(n?hide():show())}}function addEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)}function removeEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.detachEvent?(e.detachEvent("on"+t,e[t+n]),e[t+n]=null):e.removeEventListener(t,n,!1)}function InitBlackbird(){var e=document.getElementsByTagName("BODY")[0];bbird=e.appendChild(generateMarkup()),outputList=bbird.getElementsByTagName("OL")[0],backgroundImage(),addEvent(IDs.checkbox,"click",clickVis),addEvent(IDs.filters,"click",clickFilter),addEvent(IDs.controls,"click",clickControl),addEvent(document,"keyup",readKey),resize(state.size),reposition(state.pos),state.load&&(show(),document.getElementById(IDs.checkbox).checked=!0),scrollToBottom(),window[BLINGPOINT_LOG_NAMESPACE].init=function(){show(),window[BLINGPOINT_LOG_NAMESPACE].error(["<b>",BLINGPOINT_LOG_NAMESPACE,"</b> can only be initialized once"])},addEvent(window,"unload",function(){removeEvent(IDs.checkbox,"click",clickVis),removeEvent(IDs.filters,"click",clickFilter),removeEvent(IDs.controls,"click",clickControl),removeEvent(document,"keyup",readKey)}),window[BLINGPOINT_LOG_NAMESPACE].debug("BlingPoint LogViewer Loaded")}var BLINGPOINT_ROOT_NAMESPACE="blingpoint",BLINGPOINT_LOG_NAMESPACE="log";window[BLINGPOINT_LOG_NAMESPACE]={};var IE6_POSITION_FIXED=!0,bbird,outputList,cache=[],state=getState(),classes={},profiler={},IDs={blackbird:"blackbird",checkbox:"bbVis",filters:"bbFilters",controls:"bbControls",size:"bbSize"},messageTypes={debug:!0,info:!0,warn:!0,error:!0,profile:!0};window[BLINGPOINT_LOG_NAMESPACE]={initBlackbird:function(){InitBlackbird()},toggle:function(){isVisible()?hide():show()},resize:function(){resize()},clear:function(){clear()},move:function(){reposition()},debug:function(e){addMessage("debug",e)},warn:function(e){addMessage("warn",e)},info:function(e){addMessage("info",e)},error:function(e){addMessage("error",e)},profile:function(e){var t=new Date;return void 0===e||""===e?addMessage("error","<b>ERROR:</b> Please specify a label for your profile statement"):profiler[e]?(addMessage("profile",[e,": ",t-profiler[e],"ms"].join("")),delete profiler[e]):(profiler[e]=t,addMessage("profile",e)),t}},window[BLINGPOINT_ROOT_NAMESPACE].log=window[BLINGPOINT_LOG_NAMESPACE]}(),blingpoint.log.initBlackbird();var scripts=document.getElementsByTagName("script");for(i=0;scripts.length>i;i++){var blingPointDevPosition=scripts[i].src.toLowerCase().indexOf("blingpoint.js");blingPointDevPosition>-1&&blingpoint.log.toggle()}(function(){function e(e,t,n){try{blingpoint.log.error("An unexpected error has occured"),blingpoint.log.error("Description: "+e),blingpoint.log.error("Url: "+t),blingpoint.log.error("Line: "+n)}catch(i){console.log("An unexpected error has occured"),console.log("Description: "+i.description)}}function t(e,t){blingpoint.log.warn("A managed error has occured"),blingpoint.log.warn("Message: "+e),blingpoint.log.warn("Name: "+t.name),blingpoint.log.warn("Technical message: "+t.message),blingpoint.log.warn("Number: "+t.number)}function n(e){try{e!==void 0&&null!==e&&e()}catch(n){t("An error has occurred during calling a callback method",n)}}function i(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;n.length>i;i++)e=n[i].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function o(e){var t=RegExp(e,"gi");return t.test(window.location.href)?!0:!1}function l(e,t){var n=RegExp(t,"gi");return n.test(e)?!0:!1}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}var s="blingpoint",r="global";window[r]={},window[r].getUrlParameters=i,window[r].checkUrl=o,window[r].check=l,window[r].isNumber=a,window[r].handleUnhandledError=e,window[r].handleManagedError=t,window[r].executeCallback=n,window[s].global=window[r],window.onerror=blingpoint.global.handleUnhandledError})();var ctx,web,user;(function(){function e(){ctx=SP.ClientContext.get_current(),web=ctx.get_web(),ctx.load(web),user=ctx.get_web().get_currentUser(),ctx.load(user),ctx.executeQueryAsync(function(){log.info("Web Context loaded"),log.debug("web title:"+web.get_title()),log.debug("Description:"+web.get_description()),log.debug("ID:"+web.get_id()),log.debug("Created Date:"+web.get_created()),log.debug("Web Url:"+web.get_serverRelativeUrl()),log.info("Current user loaded"),log.debug("ID:"+user.get_id()),log.debug("User title:"+user.get_title()),log.debug("Email:"+user.get_email()),blingpoint.plugins.loadPlugIns()},function(e,t){blingpoint.log.error("request failed "+t.get_message()+"\n"+t.get_stackTrace())})}function t(e,t,n){var i=web.get_lists(),o=i.getByTitle(e),l=new SP.ListItemCreationInformation,a=o.addItem(l);a.set_item("Title",t),a.update(),ctx.executeQueryAsync(function(){var e;e=a.get_id(),blingpoint.log.debug(e),blingpoint.ui.addNotification("created",!1),n(e)},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error"),blingpoint.ui.addNotification("Operation was cancelled...",!1)})}function n(e,t,n,i,o){ExecuteOrDelayUntilScriptLoaded(function(){var l=web.get_lists().getByTitle(e),a=l.getItemById(t);a.set_item(n,i),a.update(),ctx.executeQueryAsync(function(){blingpoint.log.debug("Updated"),o()},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},"sp.js")}function i(e,t,n,i,o,l){ExecuteOrDelayUntilScriptLoaded(function(){var a=web.get_lists().getByTitle(e),s=a.getItemById(t);ctx.load(s,n),ctx.executeQueryAsync(function(){var e;e=new SP.FieldUrlValue,e.set_url(o),e.set_description(i),s.set_item(n,e),s.update(),ctx.executeQueryAsync(function(){log.debug("Updated"),l()},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},"sp.js")}var o="blingpoint",l="items";window[l]={},ExecuteOrDelayUntilScriptLoaded(e,"sp.js"),window[l].updateItem=n,window[l].updateItemUrl=i,window[l].createItem=t,window[o].items=window[l]})(),function(){function e(e,t,n){var i=web.get_siteGroups();ctx.load(i),ctx.executeQueryAsync(function(){var o;o=blingpoint.global.isNumber(e)?i.getById(e):i.getByName(e);var l=o.get_users();ctx.load(l),ctx.executeQueryAsync(function(){for(var e=l.getEnumerator();e.moveNext();){var i=e.get_current();if(i.get_id()==user.get_id())return t(),void 0}n()},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}var t="blingpoint",n="security";window[n]={},window[n].currentUserIsUserMemberOf=e,window[t].security=window[n]}(),function(){function e(e,t){ExecuteOrDelayUntilScriptLoaded(function(){return notificationId=SP.UI.Notify.addNotification(e,t),log.debug(notificationId),notificationId},"sp.js")}function t(e){SP.UI.Notify.removeNotification(e)}function n(e,t){return statusId=SP.UI.Status.addStatus(e),SP.UI.Status.setStatusPriColor(statusId,t),log.debug(statusId),statusId}function i(e){SP.UI.Status.removeStatus(e)}function o(){SP.UI.Status.removeAllStatus(!0)}function l(e,t,n){ExecuteOrDelayUntilScriptLoaded(function(){var i=SP.UI.$create_DialogOptions();i.url=e,i.width=t,i.height=n,i.dialogReturnValueCallback=function(e){e===SP.UI.DialogResult.OK&&(console.log("OK was clicked!"),blingpoint.ui.addNotification("New leave application request submitted",!1)),e===SP.UI.DialogResult.cancel&&console.log("Cancel was clicked!")},SP.UI.ModalDialog.showModalDialog(i)},"sp.js")}var a="blingpoint",s="ui";window[s]={},window[s].addStatus=n,window[s].removeStatus=i,window[s].removeAllStatus=o,window[s].addNotification=e,window[s].removeNotification=t,window[s].openDialog=l,window[a].ui=window[s]}(),function(){function e(){function e(){t()}function t(){$p.schema.createList("BlingPointPlugIns",SP.ListTemplateType.genericList,!1,n,null)}function n(){$p.schema.createContentTypeInHost("BlingPointPlugIn","BlingPoint PlugIn","BlingPointContentTypes",i,null)}function i(){$p.schema.createField("Text","PlugInDescription","PlugIn Description","BlingPointFields",!1,o,null)}function o(){$p.schema.createField("Text","PlugInUrlTrigger","PlugIn URL Trigger","BlingPointFields",!1,l,null)}function l(){$p.schema.createField("Text","PlugInSourceUrl","PlugIn Source URL","BlingPointFields",!1,a,null)}function a(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInDescription",s,null)}function s(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInUrlTrigger",r,null)}function r(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInSourceUrl",c,null)}function c(){$p.schema.addExistingContentTypetoList("BlingPointPlugIns","BlingPointPlugIn",d,null)}function d(){$p.schema.createList("BlingPointAssets",SP.ListTemplateType.documentLibrary,!1,null,null)}e()}function t(){var e=web.get_lists().getByTitle("BlingPointPlugIns"),t=new SP.CamlQuery,n="<View><RowLimit>500</RowLimit></View>";t.set_viewXml(n);var i=e.getItems(t);ctx.load(i,"Include(DisplayName,Id,PlugInSource,UrlTrigger)"),ctx.executeQueryAsync(function(){for(var e=i.getEnumerator();e.moveNext();){var t=e.get_current(),n=t.get_displayName(),o=t.get_id(),l=t.get_item("PlugInSource"),a=t.get_item("UrlTrigger");log.debug("Checking PlugIn : "+n),log.debug("PlugIn ID : "+o),log.debug("PlugIn URL Trigger : "+a),blingpoint.global.checkUrl(a)&&(blingpoint.global.check(l,".js")&&(log.info("Loading PlugIn : "+n),blingpoint.loader.addScriptToPage(l)),blingpoint.global.check(l,".css")&&(log.info("Loading PlugIn : "+n),blingpoint.loader.addCssToPage(l)))}},function(e,t){blingpoint.log.error("request failed "+t.get_message()+"\n"+t.get_stackTrace()),blingpoint.log.error('If the list BlingPointPlugIns does not exist, <a href="javascript:$p.plugins.setupPlugInSystem();">click here to setup BlingPoint !</a>')})}var n="blingpoint",i="plugins";window[i]={},window[i].loadPlugIns=t,window[i].setupPlugInSystem=e,window[n].plugins=window[i]}(),function(){function e(e,t){var n=web.get_allProperties();n.set_item(e,t),web.update(),ctx.executeQueryAsync(function(){blingpoint.log.debug("WebSite property "+e+" = "+t)},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function t(e,t){var n=web.get_allProperties(),i=n.get_item(e);ctx.executeQueryAsync(function(){t(i)},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}var n="blingpoint",i="parameters";window[i]={},window[i].setWebSiteProperty=e,window[i].getWebSiteProperty=t,window[n].parameters=window[i]}(),function(){function e(e,t,n,i,o,l,a){var s=web.get_fields(),r="<Field Type='"+e+"' DisplayName='"+n+"' Name='"+t+"' Group='"+i+"' Hidden='"+o+"'></Field>",c=s.addFieldAsXml(r,!1,SP.AddFieldOptions.AddToNoContentType);ctx.load(s),ctx.load(c),ctx.executeQueryAsync(function(){blingpoint.log.debug("Field provisioned in host web successfully."),blingpoint.global.executeCallback(l)},function(e){blingpoint.log.warn("Failed to provision field into host web. Error:"+e.statusCode),blingpoint.global.executeCallback(a)})}function t(e,t,n,i,o){hostWebContentTypes=web.get_contentTypes();var l=new SP.ContentTypeCreationInformation;l.set_name(e),l.set_description(t),l.set_group(n),hostWebContentTypes.add(l),ctx.load(hostWebContentTypes),ctx.executeQueryAsync(function(){blingpoint.log.debug("Content type provisioned in host web successfully."),blingpoint.global.executeCallback(i)},function(e){blingpoint.log.warn("Failed to provision content type into host web. Error:"+e.statusCode),blingpoint.global.executeCallback(o)})}function n(e,t,n,o){createdFieldInternalName=t,createdContentTypeName=e,createdField=web.get_fields().getByInternalNameOrTitle(t),ctx.load(createdField),hostWebContentTypes=web.get_contentTypes(),ctx.load(hostWebContentTypes),ctx.executeQueryAsync(function(){i(createdContentTypeName,createdFieldInternalName,n,o)},function(e){blingpoint.log.warn("Failed to re-fetch field and content type. Error:"+e.statusCode),blingpoint.global.executeCallback(o)})}function i(e,t,n,i){for(var o,l=!1,a=hostWebContentTypes.getEnumerator();a.moveNext();){var s=a.get_current();if(s.get_name()===e){l=!0,o=s;break}}if(l){var r=new SP.FieldLinkCreationInformation;r.set_field(createdField),o.get_fieldLinks().add(r),o.update(!0),ctx.load(o),ctx.executeQueryAsync(function(){blingpoint.log.debug("Field added to content type in host web successfully."),blingpoint.global.executeCallback(n)},function(e){blingpoint.log.warn("Failed to add field to content type. Error:"+e.statusCode),blingpoint.global.executeCallback(i)})}else blingpoint.log.warn("Failed to add field to content type - check the content type exists!"),blingpoint.global.executeCallback(i)}function o(e,t,n,i){hostWebContentTypes=web.get_contentTypes(),ctx.load(hostWebContentTypes),ctx.executeQueryAsync(function(){for(var o=hostWebContentTypes.getEnumerator();o.moveNext();){var a=o.get_current();a.get_name()===t&&l(e,a,n,i)}},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace()),blingpoint.global.executeCallback(i)})}function l(e,t,n,i){listCollection=web.get_lists(),list=listCollection.getByTitle(e),listContentTypeColl=list.get_contentTypes(),listContentTypeColl.addExistingContentType(t),ctx.load(listContentTypeColl),ctx.executeQueryAsync(function(){blingpoint.log.debug("Content Type added successfully"),blingpoint.global.executeCallback(n)},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace()),blingpoint.global.executeCallback(i)})}function a(e,t,n,i,o){var l=new SP.ListCreationInformation;switch(l.set_title(e),null!==t?l.set_templateType(t):l.set_templateType(SP.ListTemplateType.genericList),n){case!0:l.set_quickLaunchOption(SP.QuickLaunchOptions.on);break;case!1:l.set_quickLaunchOption(SP.QuickLaunchOptions.off);break;default:l.set_quickLaunchOption(SP.QuickLaunchOptions.off)}var a=web.get_lists().add(l);ctx.load(a),ctx.executeQueryAsync(function(){blingpoint.log.info("List <b>"+a.get_title()+"</b> created...",!1),blingpoint.global.executeCallback(i)},function(e,t){handleManagedError("Operation was cancelled...",e,t),blingpoint.log.warn("List creation operation was cancelled...",!1),blingpoint.global.executeCallback(o)})}function s(e,t,n,i,o,l,a,s){var r=new SP.WebCreationInformation;r.set_title(e),r.set_description(t),r.set_url(n),r.set_language(i),r.set_webTemplate(o),r.set_useSamePermissionsAsParentSite(l),oNewWebsite=web.get_webs().add(r),ctx.load(oNewWebsite),ctx.executeQueryAsync(function(){var e;e=oNewWebsite.get_serverRelativeUrl(),log.info("Site Created"),log.debug("Site Url : "+e),blingpoint.global.executeCallback(a)},function(e,t){log.warn("Site creation failed : "+t.get_message()+"\n"+t.get_stackTrace()),blingpoint.global.executeCallback(s)})}var r="blingpoint",c="schema";window[c]={},window[c].createField=e,window[c].createContentTypeInHost=t,window[c].addFieldToContentTypeInHost=n,window[c].addExistingContentTypetoList=o,window[c].createList=a,window[c].createSite=s,window[r].schema=window[c]}();