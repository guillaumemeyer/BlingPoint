/*! BlingPoint 01-08-2013 */
(function(){function e(){var e=document.getElementsByTagName("script");for(i=0;e.length>i;i++)if(e[i].src.indexOf("BlingPoint.js")>-1)return e[i].src.substring(0,e[i].src.length-13)}function t(e){var t=document.createElement("link");t.type="text/css",t.rel="Stylesheet",t.href=e;var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(t),console.log("CSS loaded : "+e)}function n(e){var t=document.createElement("script");t.type="text/JavaScript",t.src=e,t.async=!1;var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(t),console.log("Script loaded : "+e)}var o="$p",a="$P",s="blingpoint",r="loader";window[s]={},window[r]={};var l=e(),c=l+"BlackbirdJs/blackbird.min.css";t(c),window[r].addCssToPage=t,window[r].addScriptToPage=n,window[s].loader=window[r],window[o]=window[s],window[a]=window[s]})(),function(){function generateMarkup(){var e=[];for(var t in messageTypes)e.push(['<span class="',t,'" type="',t,'"></span>'].join(""));var n=document.createElement("DIV");return n.id=IDs.blackbird,n.style.display="none",n.innerHTML=['<div class="header">','<div class="left">','<div id="',IDs.filters,'" class="filters" title="click to filter by message type">',e.join(""),"</div>","</div>",'<div class="right">','<div id="',IDs.controls,'" class="controls">','<span id="',IDs.size,'" title="contract" op="resize"></span>','<span class="clear" title="clear" op="clear"></span>','<span class="close" title="close" op="close"></span>',"</div>","</div>","</div>",'<div class="main">','<div class="left"></div><div class="mainBody">',"<ol>",cache.join(""),"</ol>",'</div><div class="right"></div>',"</div>",'<div class="footer">','<div class="left"><label for="',IDs.checkbox,'"><input type="checkbox" id="',IDs.checkbox,'" />Visible on page load</label></div>','<div class="right"></div>',"</div>"].join(""),n}function backgroundImage(){var e=document.getElementsByTagName("BODY")[0];e.currentStyle&&IE6_POSITION_FIXED&&("none"==e.currentStyle.backgroundImage&&(e.style.backgroundImage="url(about:blank)"),"scroll"==e.currentStyle.backgroundAttachment&&(e.style.backgroundAttachment="fixed"))}function addMessage(e,t){if(t=t.constructor==Array?t.join(""):t,outputList){var n=document.createElement("LI");n.className=e,n.innerHTML=['<span class="icon"></span>',t].join(""),outputList.appendChild(n),scrollToBottom()}}function clear(){outputList.innerHTML=""}function clickControl(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if("SPAN"==t.tagName)switch(t.getAttributeNode("op").nodeValue){case"resize":resize();break;case"clear":clear();break;case"close":hide()}}function clickFilter(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;if(t&&"SPAN"==t.tagName){var n=t.getAttributeNode("type").nodeValue;if(e.altKey){var i=document.getElementById(IDs.filters).getElementsByTagName("SPAN"),o=0;for(var a in messageTypes)messageTypes[a]&&o++;for(var s=1==o&&messageTypes[n],r=0;i[r];r++){var l=i[r].getAttributeNode("type").nodeValue;i[r].className=s||l==n?l:l+"Disabled",messageTypes[l]=s||l==n}}else messageTypes[n]=!messageTypes[n],t.className=messageTypes[n]?n:n+"Disabled";var c=[];for(var d in messageTypes)messageTypes[d]||c.push(d);c.push(""),outputList.className=c.join("Hidden "),scrollToBottom()}}function clickVis(e){e||(e=window.event);var t=e.target?e.target:e.srcElement;state.load=t.checked,setState()}function scrollToBottom(){outputList.scrollTop=outputList.scrollHeight}function isVisible(){return"block"==bbird.style.display}function hide(){bbird.style.display="none"}function show(){var e=document.getElementsByTagName("BODY")[0];e.removeChild(bbird),e.appendChild(bbird),bbird.style.display="block",bbird.style.zIndex="15000"}function reposition(e){switch((void 0===e||null===e)&&(e=state&&null===state.pos?1:(state.pos+1)%4),e){case 0:classes[0]="bbTopLeft";break;case 1:classes[0]="bbTopRight";break;case 2:classes[0]="bbBottomLeft";break;case 3:classes[0]="bbBottomRight"}state.pos=e,setState()}function resize(e){(void 0===e||null===e)&&(e=state&&null===state.size?0:(state.size+1)%2),classes[1]=0===e?"bbSmall":"bbLarge";var t=document.getElementById(IDs.size);t.title=1===e?"small":"large",t.className=t.title,state.size=e,setState(),scrollToBottom()}function setState(){var e=[];for(var t in state){var n=state[t]&&state[t].constructor===String?'"'+state[t]+'"':state[t];e.push(t+":"+n)}e=e.join(",");var i=new Date;i.setDate(i.getDate()+14),document.cookie=["blackbird={",e,"}; expires=",i.toUTCString(),";"].join("");var o=[];for(var a in classes)o.push(classes[a]);bbird.className=o.join(" ")}function getState(){var re=RegExp(/blackbird=({[^;]+})(;|\b|$)/),match=re.exec(document.cookie);return match&&match[1]?eval("("+match[1]+")"):{pos:null,size:null,load:null}}function readKey(e){e||(e=window.event);var t=113;if(e&&e.keyCode==t){var n=isVisible();n&&e.shiftKey&&e.altKey?clear():n&&e.shiftKey?reposition():e.shiftKey||e.altKey||(n?hide():show())}}function addEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.attachEvent?(e["e"+t+n]=n,e[t+n]=function(){e["e"+t+n](window.event)},e.attachEvent("on"+t,e[t+n])):e.addEventListener(t,n,!1)}function removeEvent(e,t,n){var e=e.constructor===String?document.getElementById(e):e;e.detachEvent?(e.detachEvent("on"+t,e[t+n]),e[t+n]=null):e.removeEventListener(t,n,!1)}function InitBlackbird(){var e=document.getElementsByTagName("BODY")[0];bbird=e.appendChild(generateMarkup()),outputList=bbird.getElementsByTagName("OL")[0],backgroundImage(),addEvent(IDs.checkbox,"click",clickVis),addEvent(IDs.filters,"click",clickFilter),addEvent(IDs.controls,"click",clickControl),addEvent(document,"keyup",readKey),resize(state.size),reposition(state.pos),state.load&&(show(),document.getElementById(IDs.checkbox).checked=!0),scrollToBottom(),window[BLINGPOINT_LOG_NAMESPACE].init=function(){show(),window[BLINGPOINT_LOG_NAMESPACE].error(["<b>",BLINGPOINT_LOG_NAMESPACE,"</b> can only be initialized once"])},addEvent(window,"unload",function(){removeEvent(IDs.checkbox,"click",clickVis),removeEvent(IDs.filters,"click",clickFilter),removeEvent(IDs.controls,"click",clickControl),removeEvent(document,"keyup",readKey)}),window[BLINGPOINT_LOG_NAMESPACE].debug("BlingPoint LogViewer Loaded")}var BLINGPOINT_ROOT_NAMESPACE="blingpoint",BLINGPOINT_LOG_NAMESPACE="log";window[BLINGPOINT_LOG_NAMESPACE]={};var IE6_POSITION_FIXED=!0,bbird,outputList,cache=[],state=getState(),classes={},profiler={},IDs={blackbird:"blackbird",checkbox:"bbVis",filters:"bbFilters",controls:"bbControls",size:"bbSize"},messageTypes={debug:!0,info:!0,warn:!0,error:!0,profile:!0};window[BLINGPOINT_LOG_NAMESPACE]={initBlackbird:function(){InitBlackbird()},toggle:function(){isVisible()?hide():show()},resize:function(){resize()},clear:function(){clear()},move:function(){reposition()},debug:function(e){addMessage("debug",e)},warn:function(e){addMessage("warn",e)},info:function(e){addMessage("info",e)},error:function(e){addMessage("error",e)},profile:function(e){var t=new Date;return void 0===e||""===e?addMessage("error","<b>ERROR:</b> Please specify a label for your profile statement"):profiler[e]?(addMessage("profile",[e,": ",t-profiler[e],"ms"].join("")),delete profiler[e]):(profiler[e]=t,addMessage("profile",e)),t}},window[BLINGPOINT_ROOT_NAMESPACE].log=window[BLINGPOINT_LOG_NAMESPACE]}(),blingpoint.log.initBlackbird(),function(){function e(e,t,n,i){try{blingpoint.log.error("An unexpected error has occured"),blingpoint.log.error("Description: "+e),blingpoint.log.error("Page: "+t),blingpoint.log.error("Line: "+n),blingpoint.log.error("Chr: "+i)}catch(o){console.log("An unexpected error has occured"),console.log("Description: "+o.description)}return!0}function t(e,t,n){return blingpoint.log.warn("A managed error has occured"),blingpoint.log.warn("Message: "+e),blingpoint.log.warn("Technical message: "+n.get_message()),blingpoint.log.warn("Stack trace: "+n.get_stackTrace()),!0}function n(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;n.length>i;i++)e=n[i].split("="),t.push(e[0]),t[e[0]]=e[1];return t}function i(e){var t=RegExp(e,"gi");return t.test(window.location.href)?!0:!1}function o(e,t){var n=RegExp(t,"gi");return n.test(e)?!0:!1}function a(e){return!isNaN(parseFloat(e))&&isFinite(e)}var s="blingpoint",r="global";window[r]={},window[r].getUrlParameters=n,window[r].checkUrl=i,window[r].check=o,window[r].isNumber=a,window[r].handleUnhandledError=e,window[r].handleManagedError=t,window[s].global=window[r],window.onerror=blingpoint.global.handleUnhandledError}();var ctx,web,user;(function(){function e(){ctx=SP.ClientContext.get_current(),web=ctx.get_web(),ctx.load(web),user=ctx.get_web().get_currentUser(),ctx.load(user),ctx.executeQueryAsync(Function.createDelegate(this,t),Function.createDelegate(this,n))}function t(){log.info("Web Context loaded"),log.debug("web title:"+web.get_title()),log.debug("Description:"+web.get_description()),log.debug("ID:"+web.get_id()),log.debug("Created Date:"+web.get_created()),log.debug("Web Url:"+web.get_serverRelativeUrl()),log.info("Current user loaded"),log.debug("ID:"+user.get_id()),log.debug("User title:"+user.get_title()),log.debug("Email:"+user.get_email()),blingpoint.plugins.loadPlugIns()}function n(e,t){blingpoint.log.error("request failed "+t.get_message()+"\n"+t.get_stackTrace())}function i(e,t,n,i,s){var r=web.get_fields(),l="<Field Type='"+e+"' DisplayName='"+n+"' Name='"+t+"' Group='"+i+"' Hidden='"+s+"'></Field>",c=r.addFieldAsXml(l,!1,SP.AddFieldOptions.AddToNoContentType);ctx.load(r),ctx.load(c),ctx.executeQueryAsync(o,a)}function o(){blingpoint.log.debug("Field provisioned in host web successfully.")}function a(e){blingpoint.log.warn("Failed to provision field into host web. Error:"+e.statusCode)}function s(e,t,n){hostWebContentTypes=web.get_contentTypes();var i=new SP.ContentTypeCreationInformation;i.set_name(e),i.set_description(t),i.set_group(n),hostWebContentTypes.add(i),ctx.load(hostWebContentTypes),ctx.executeQueryAsync(r,l)}function r(){blingpoint.log.debug("Content type provisioned in host web successfully.")}function l(e){blingpoint.log.warn("Failed to provision content type into host web. Error:"+e.statusCode)}function c(e,t){createdFieldInternalName=t,createdContentTypeName=e,createdField=web.get_fields().getByInternalNameOrTitle(t),ctx.load(createdField),hostWebContentTypes=web.get_contentTypes(),ctx.load(hostWebContentTypes),ctx.executeQueryAsync(d,u)}function d(){g(createdContentTypeName,createdFieldInternalName)}function u(e){blingpoint.log.warn("Failed to re-fetch field and content type. Error:"+e.statusCode)}function g(e){for(var t,n=!1,i=hostWebContentTypes.getEnumerator();i.moveNext();){var o=i.get_current();if(o.get_name()===e){n=!0,t=o;break}}if(n){var a=new SP.FieldLinkCreationInformation;a.set_field(createdField),t.get_fieldLinks().add(a),t.update(!0),ctx.load(t),ctx.executeQueryAsync(p,b)}else blingpoint.log.warn("Failed to add field to content type - check the content type exists!")}function p(){blingpoint.log.debug("Field added to content type in host web successfully.")}function b(e){blingpoint.log.warn("Failed to add field to content type. Error:"+e.statusCode)}function w(e,t){var n,i,o,a,s;n=web.get_contentTypes(),i=n.getById(t),o=web.get_lists(),a=o.getByTitle(e),s=a.get_contentTypes(),s.addExistingContentType(i),ctx.load(s),ctx.executeQueryAsync(f,m)}function f(){blingpoint.log.debug("Content Type added successfully")}function m(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())}function y(e,t,n){var i=web.get_siteGroups();ctx.load(i),ctx.executeQueryAsync(function(){var o;o=blingpoint.global.isNumber(e)?i.getById(e):i.getByName(e);var a=o.get_users();ctx.load(a),ctx.executeQueryAsync(function(){for(var e=a.getEnumerator();e.moveNext();){var i=e.get_current();if(i.get_id()==user.get_id())return t(),void 0}n()},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function v(e,t){var n=web.get_allProperties();n.set_item(e,t),web.update(),ctx.executeQueryAsync(function(){blingpoint.log.debug("WebSite property "+e+" = "+t)},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function h(e,t){var n=web.get_allProperties(),i=n.get_item(e);ctx.executeQueryAsync(function(){t(i)},function(e,t){blingpoint.log.warn("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function I(){var e=web.get_lists().getByTitle("BlingPointPlugIns"),t=new SP.CamlQuery,n="<View><RowLimit>50</RowLimit></View>";t.set_viewXml(n);var i=e.getItems(t);ctx.load(i,"Include(DisplayName,Id,PlugInSource,UrlTrigger)"),ctx.executeQueryAsync(function(){for(var e=i.getEnumerator();e.moveNext();){var t=e.get_current(),n=t.get_displayName(),o=t.get_id(),a=t.get_item("PlugInSource"),s=t.get_item("UrlTrigger");log.debug("Checking PlugIn : "+n),log.debug("PlugIn ID : "+o),log.debug("PlugIn URL Trigger : "+s),blingpoint.global.checkUrl(s)&&(blingpoint.global.check(a,".js")&&(log.info("Loading PlugIn : "+n),blingpoint.loader.addScriptToPage(a)),blingpoint.global.check(a,".css")&&(log.info("Loading PlugIn : "+n),blingpoint.loader.addCssToPage(a)))}},function(e,t){blingpoint.log.error("request failed "+t.get_message()+"\n"+t.get_stackTrace())})}function _(e,t){ExecuteOrDelayUntilScriptLoaded(function(){return notificationId=SP.UI.Notify.addNotification(e,t),log.debug(notificationId),notificationId},"sp.js")}function T(e){SP.UI.Notify.removeNotification(e)}function E(e,t){return statusId=SP.UI.Status.addStatus(e),SP.UI.Status.setStatusPriColor(statusId,t),log.debug(statusId),statusId}function k(e){SP.UI.Status.removeStatus(e)}function S(){SP.UI.Status.removeAllStatus(!0)}function x(e,t,n){ExecuteOrDelayUntilScriptLoaded(function(){var i=SP.UI.$create_DialogOptions();i.url=e,i.width=t,i.height=n,i.dialogReturnValueCallback=function(e){e===SP.UI.DialogResult.OK&&(console.log("OK was clicked!"),blingpoint.ui.addNotification("New leave application request submitted",!1)),e===SP.UI.DialogResult.cancel&&console.log("Cancel was clicked!")},SP.UI.ModalDialog.showModalDialog(i)},"sp.js")}function N(e,t,n,i,o,a,s){ExecuteOrDelayUntilScriptLoaded(function(){var r=new SP.WebCreationInformation;r.set_title(e),r.set_description(t),r.set_url(n),r.set_language(i),r.set_webTemplate(o),r.set_useSamePermissionsAsParentSite(a),oNewWebsite=web.get_webs().add(r),ctx.load(oNewWebsite),ctx.executeQueryAsync(function(){var e;e=oNewWebsite.get_serverRelativeUrl(),log.info("Site Created"),log.debug("Site Url : "+e),s(e)},function(e,t){log.warn("Site creation failed : "+t.get_message()+"\n"+t.get_stackTrace())})},"sp.js")}function P(e,t,n){var i=new SP.ListCreationInformation;switch(i.set_title(e),t){case 100:i.set_templateType(SP.ListTemplateType.genericList);break;case 104:i.set_templateType(SP.ListTemplateType.announcements);break;default:i.set_templateType(SP.ListTemplateType.announcements)}switch(n){case!0:i.set_quickLaunchOption(SP.QuickLaunchOptions.on);break;case!1:i.set_quickLaunchOption(SP.QuickLaunchOptions.off);break;default:i.set_quickLaunchOption(SP.QuickLaunchOptions.off)}var o=web.get_lists().add(i);ctx.load(o),ctx.executeQueryAsync(function(){log.debug("Created"),blingpoint.ui.addNotification("List <b>"+o.get_title()+"</b> created...",!1)},function(e,t){handleManagedError("Operation was cancelled...",e,t),log.debug("Error"),blingpoint.ui.addNotification("Operation was cancelled...",!1)})}function L(e,t,n){var i=web.get_lists(),o=i.getByTitle(e),a=new SP.ListItemCreationInformation,s=o.addItem(a);s.set_item("Title",t),s.update(),ctx.executeQueryAsync(function(){var e;e=s.get_id(),blingpoint.log.debug(e),blingpoint.ui.addNotification("created",!1),n(e)},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error"),blingpoint.ui.addNotification("Operation was cancelled...",!1)})}function C(e,t,n,i,o){ExecuteOrDelayUntilScriptLoaded(function(){var a=web.get_lists().getByTitle(e),s=a.getItemById(t);s.set_item(n,i),s.update(),ctx.executeQueryAsync(function(){blingpoint.log.debug("Updated"),o()},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},"sp.js")}function O(e,t,n,i,o,a){ExecuteOrDelayUntilScriptLoaded(function(){var s=web.get_lists().getByTitle(e),r=s.getItemById(t);ctx.load(r,n),ctx.executeQueryAsync(function(){var e;e=new SP.FieldUrlValue,e.set_url(o),e.set_description(i),r.set_item(n,e),r.update(),ctx.executeQueryAsync(function(){log.debug("Updated"),a()},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},function(e,t){blingpoint.global.handleManagedError("Operation was cancelled...",e,t),blingpoint.log.debug("Error")})},"sp.js")}var A="blingpoint",B="plugins",D="schema",U="security",M="parameters",F="ui",R="sites",Q="lists",G="items";window[B]={},window[D]={},window[U]={},window[M]={},window[F]={},window[R]={},window[Q]={},window[G]={},ExecuteOrDelayUntilScriptLoaded(e,"sp.js"),window[B].loadPlugIns=I,window[D].createField=i,window[D].createContentTypeInHost=s,window[D].addFieldToContentTypeInHost=c,window[D].addExistingContentTypetoList=w,window[U].isUserMemberOf=y,window[M].setWebSiteProperty=v,window[M].getWebSiteProperty=h,window[F].addStatus=E,window[F].removeStatus=k,window[F].removeAllStatus=S,window[F].addNotification=_,window[F].removeNotification=T,window[F].openDialog=x,window[R].createSite=N,window[Q].createList=P,window[G].updateItem=C,window[G].updateItemUrl=O,window[G].createItem=L,window[A].plugins=window[B],window[A].schema=window[D],window[A].security=window[U],window[A].parameters=window[M],window[A].ui=window[F],window[A].sites=window[R],window[A].lists=window[Q],window[A].items=window[G]})();