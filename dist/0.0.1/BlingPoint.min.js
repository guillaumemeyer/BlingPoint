/*! BlingPoint 03-09-2013 */
var BlingPointDevMode;!function(){function a(){var a=document.getElementsByTagName("script");for(i=0;i<a.length;i++){var b=a[i].src.toLowerCase().indexOf("blingpoint.js");if(b>-1)return BlingPointDevMode=!0,a[i].src.substring(0,b);var c=a[i].src.toLowerCase().indexOf("blingpoint.min.js");if(c>-1)return BlingPointDevMode=!1,a[i].src.substring(0,c)}}function b(a){var b=document.createElement("link");b.type="text/css",b.rel="Stylesheet",b.href=a;var c=document.head||document.getElementsByTagName("head")[0];return c.appendChild(b),!0}function c(a){var b=document.createElement("script");b.type="text/JavaScript",b.src=a,b.async=!1;var c=document.head||document.getElementsByTagName("head")[0];return c.appendChild(b),!0}var d="$p",e="$P",f="blingpoint",g="loader";window[f]={},window[g]={};var h=a(),j=h+"BlackbirdJs/blackbird.min.css";b(j),window[g].addCssToPage=b,window[g].addScriptToPage=c,window[f].loader=window[g],window[d]=window[f],window[e]=window[f]}(),function(){function generateMarkup(){var a=[];for(var b in messageTypes)a.push(['<span class="',b,'" type="',b,'"></span>'].join(""));var c=document.createElement("DIV");return c.id=IDs.blackbird,c.style.display="none",c.innerHTML=['<div class="header">','<div class="left">','<div id="',IDs.filters,'" class="filters" title="click to filter by message type">',a.join(""),"</div>","</div>",'<div class="right">','<div id="',IDs.controls,'" class="controls">','<span id="',IDs.size,'" title="contract" op="resize"></span>','<span class="clear" title="clear" op="clear"></span>','<span class="close" title="close" op="close"></span>',"</div>","</div>","</div>",'<div class="main">','<div class="left"></div><div class="mainBody">',"<ol>",cache.join(""),"</ol>",'</div><div class="right"></div>',"</div>",'<div class="footer">','<div class="left"><label for="',IDs.checkbox,'"><input type="checkbox" id="',IDs.checkbox,'" />Visible on page load</label></div>','<div class="right"></div>',"</div>"].join(""),c}function backgroundImage(){var a=document.getElementsByTagName("BODY")[0];a.currentStyle&&IE6_POSITION_FIXED&&("none"==a.currentStyle.backgroundImage&&(a.style.backgroundImage="url(about:blank)"),"scroll"==a.currentStyle.backgroundAttachment&&(a.style.backgroundAttachment="fixed"))}function addMessage(a,b){if(b=b.constructor==Array?b.join(""):b,outputList){var c=document.createElement("LI");c.className=a,c.innerHTML=['<span class="icon"></span>',b].join(""),outputList.appendChild(c),scrollToBottom()}}function clear(){outputList.innerHTML=""}function clickControl(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;if("SPAN"==b.tagName)switch(b.getAttributeNode("op").nodeValue){case"resize":resize();break;case"clear":clear();break;case"close":hide()}}function clickFilter(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;if(b&&"SPAN"==b.tagName){var c=b.getAttributeNode("type").nodeValue;if(a.altKey){var d=document.getElementById(IDs.filters).getElementsByTagName("SPAN"),e=0;for(var f in messageTypes)messageTypes[f]&&e++;for(var g=1==e&&messageTypes[c],h=0;d[h];h++){var i=d[h].getAttributeNode("type").nodeValue;d[h].className=g||i==c?i:i+"Disabled",messageTypes[i]=g||i==c}}else messageTypes[c]=!messageTypes[c],b.className=messageTypes[c]?c:c+"Disabled";var j=[];for(var k in messageTypes)messageTypes[k]||j.push(k);j.push(""),outputList.className=j.join("Hidden "),scrollToBottom()}}function clickVis(a){a||(a=window.event);var b=a.target?a.target:a.srcElement;state.load=b.checked,setState()}function scrollToBottom(){outputList.scrollTop=outputList.scrollHeight}function isVisible(){return"block"==bbird.style.display}function hide(){bbird.style.display="none"}function show(){var a=document.getElementsByTagName("BODY")[0];a.removeChild(bbird),a.appendChild(bbird),bbird.style.display="block",bbird.style.zIndex="15000"}function reposition(a){switch((void 0===a||null===a)&&(a=state&&null===state.pos?1:(state.pos+1)%4),a){case 0:classes[0]="bbTopLeft";break;case 1:classes[0]="bbTopRight";break;case 2:classes[0]="bbBottomLeft";break;case 3:classes[0]="bbBottomRight"}state.pos=a,setState()}function resize(a){(void 0===a||null===a)&&(a=state&&null===state.size?0:(state.size+1)%2),classes[1]=0===a?"bbSmall":"bbLarge";var b=document.getElementById(IDs.size);b.title=1===a?"small":"large",b.className=b.title,state.size=a,setState(),scrollToBottom()}function setState(){var a=[];for(var b in state){var c=state[b]&&state[b].constructor===String?'"'+state[b]+'"':state[b];a.push(b+":"+c)}a=a.join(",");var d=new Date;d.setDate(d.getDate()+14),document.cookie=["blackbird={",a,"}; expires=",d.toUTCString(),";"].join("");var e=[];for(var f in classes)e.push(classes[f]);bbird.className=e.join(" ")}function getState(){var re=new RegExp(/blackbird=({[^;]+})(;|\b|$)/),match=re.exec(document.cookie);return match&&match[1]?eval("("+match[1]+")"):{pos:null,size:null,load:null}}function readKey(a){a||(a=window.event);var b=113;if(a&&a.keyCode==b){var c=isVisible();c&&a.shiftKey&&a.altKey?clear():c&&a.shiftKey?reposition():a.shiftKey||a.altKey||(c?hide():show())}}function addEvent(a,b,c){var a=a.constructor===String?document.getElementById(a):a;a.attachEvent?(a["e"+b+c]=c,a[b+c]=function(){a["e"+b+c](window.event)},a.attachEvent("on"+b,a[b+c])):a.addEventListener(b,c,!1)}function removeEvent(a,b,c){var a=a.constructor===String?document.getElementById(a):a;a.detachEvent?(a.detachEvent("on"+b,a[b+c]),a[b+c]=null):a.removeEventListener(b,c,!1)}function InitBlackbird(){var a=document.getElementsByTagName("BODY")[0];bbird=a.appendChild(generateMarkup()),outputList=bbird.getElementsByTagName("OL")[0],backgroundImage(),addEvent(IDs.checkbox,"click",clickVis),addEvent(IDs.filters,"click",clickFilter),addEvent(IDs.controls,"click",clickControl),addEvent(document,"keyup",readKey),resize(state.size),reposition(state.pos),state.load&&(show(),document.getElementById(IDs.checkbox).checked=!0),scrollToBottom(),window[BLINGPOINT_LOG_NAMESPACE].init=function(){show(),window[BLINGPOINT_LOG_NAMESPACE].error(["<b>",BLINGPOINT_LOG_NAMESPACE,"</b> can only be initialized once"])},addEvent(window,"unload",function(){removeEvent(IDs.checkbox,"click",clickVis),removeEvent(IDs.filters,"click",clickFilter),removeEvent(IDs.controls,"click",clickControl),removeEvent(document,"keyup",readKey)}),window[BLINGPOINT_LOG_NAMESPACE].info("BlingPoint LogViewer Loaded")}var BLINGPOINT_ROOT_NAMESPACE="blingpoint",BLINGPOINT_LOG_NAMESPACE="log";window[BLINGPOINT_LOG_NAMESPACE]={};var IE6_POSITION_FIXED=!0,bbird,outputList,cache=[],state=getState(),classes={},profiler={},IDs={blackbird:"blackbird",checkbox:"bbVis",filters:"bbFilters",controls:"bbControls",size:"bbSize"},messageTypes={debug:!0,info:!0,warn:!0,error:!0,profile:!0};window[BLINGPOINT_LOG_NAMESPACE]={initBlackbird:function(){InitBlackbird()},toggle:function(){isVisible()?hide():show()},resize:function(){resize()},clear:function(){clear()},move:function(){reposition()},debug:function(a){addMessage("debug",a)},warn:function(a){addMessage("warn",a)},info:function(a){addMessage("info",a)},error:function(a){addMessage("error",a)},profile:function(a){var b=new Date;return void 0===a||""===a?addMessage("error","<b>ERROR:</b> Please specify a label for your profile statement"):profiler[a]?(addMessage("profile",[a,": ",b-profiler[a],"ms"].join("")),delete profiler[a]):(profiler[a]=b,addMessage("profile",a)),b}},window[BLINGPOINT_ROOT_NAMESPACE].log=window[BLINGPOINT_LOG_NAMESPACE]}(),blingpoint.log.initBlackbird(),1==BlingPointDevMode&&(blingpoint.log.toggle(),blingpoint.log.profile("scriptLoading"));var blingpointContext,blingpointHostContext,blingpointWeb,blingpointHostWeb,blingpointUser;!function(){function a(){BlingPointDevMode===!0&&blingpoint.log.profile("contextLoading"),blingpointContext=SP.ClientContext.get_current(),blingpointWeb=blingpointContext.get_web(),blingpointContext.load(blingpointWeb),blingpointUser=blingpointContext.get_web().get_currentUser(),blingpointContext.load(blingpointUser),blingpointContext.executeQueryAsync(function(){if(log.info("Web Context loaded"),log.debug("web title:"+blingpointWeb.get_title()),log.debug("Description:"+blingpointWeb.get_description()),log.debug("ID:"+blingpointWeb.get_id()),log.debug("Created Date:"+blingpointWeb.get_created()),log.debug("Web Url:"+blingpointWeb.get_serverRelativeUrl()),log.info("Current user loaded"),log.debug("ID:"+blingpointUser.get_id()),log.debug("User title:"+blingpointUser.get_title()),log.debug("Email:"+blingpointUser.get_email()),void 0!==g&&null!==g&&void 0!==h&&null!==h){blingpoint.log.debug("App context detected, loading both SPHost context");var a=new SP.ProxyWebRequestExecutorFactory(h);blingpointContext.set_webRequestExecutorFactory(a);var b=new SP.AppContextSite(ctx,g);blingpointHostWeb=b.get_web(),blingpointContext.load(blingpointHostWeb),blingpointContext.executeQueryAsync(function(){log.info("Host Web Context loaded"),log.debug("Host web title:"+blingpointHostWeb.get_title()),log.debug("Host Description:"+blingpointHostWeb.get_description()),log.debug("Host ID:"+blingpointHostWeb.get_id()),log.debug("Host Created Date:"+blingpointHostWeb.get_created()),log.debug("Host Web Url:"+blingpointHostWeb.get_serverRelativeUrl()),BlingPointDevMode===!0&&blingpoint.log.profile("contextLoading")},function(a,b){BlingPointDevMode===!0&&blingpoint.log.profile("contextLoading"),"System.UnauthorizedAccessException"==b.get_errorTypeName()?(blingpoint.log.error("Your App is not authorized to access Host Web. Check your App manifest."),blingpoint.log.error(b.get_message()+"\n"+b.get_stackTrace())):blingpoint.log.error("request failed "+b.get_message()+"\n"+b.get_stackTrace())})}else BlingPointDevMode===!0&&blingpoint.log.profile("contextLoading"),blingpoint.plugins.loadPlugIns()},function(a,b){BlingPointDevMode===!0&&blingpoint.log.profile("contextLoading"),blingpoint.log.error("request failed "+b.get_message()+"\n"+b.get_stackTrace())})}function b(a,b,c){var d=blingpointWeb.get_lists(),e=d.getByTitle(a),f=new SP.ListItemCreationInformation,g=e.addItem(f);g.set_item("Title",b),g.update(),blingpointContext.executeQueryAsync(function(){var a;a=g.get_id(),blingpoint.log.debug(a),blingpoint.ui.addNotification("created",!1),c(a)},function(a,b){blingpoint.global.handleManagedError("Operation was cancelled...",a,b),blingpoint.log.debug("Error"),blingpoint.ui.addNotification("Operation was cancelled...",!1)})}function c(a,b,c,d,e){ExecuteOrDelayUntilScriptLoaded(function(){var f=blingpointWeb.get_lists().getByTitle(a),g=f.getItemById(b);g.set_item(c,d),g.update(),blingpointContext.executeQueryAsync(function(){blingpoint.log.debug("Updated"),e()},function(a,b){blingpoint.global.handleManagedError("Operation was cancelled...",a,b),blingpoint.log.debug("Error")})},"sp.js")}function d(a,b,c,d,e,f){ExecuteOrDelayUntilScriptLoaded(function(){var g=blingpointWeb.get_lists().getByTitle(a),h=g.getItemById(b);blingpointContext.load(h,c),blingpointContext.executeQueryAsync(function(){var a;a=new SP.FieldUrlValue,a.set_url(e),a.set_description(d),h.set_item(c,a),h.update(),blingpointContext.executeQueryAsync(function(){log.debug("Updated"),f()},function(a,b){blingpoint.global.handleManagedError("Operation was cancelled...",a,b),blingpoint.log.debug("Error")})},function(a,b){blingpoint.global.handleManagedError("Operation was cancelled...",a,b),blingpoint.log.debug("Error")})},"sp.js")}var e="blingpoint",f="items";window[f]={};var g=blingpoint.global.getUrlParameters().SPHostUrl,h=blingpoint.global.getUrlParameters().SPAppWebUrl;void 0!==g&&null!==g&&void 0!==h&&null!==h?(blingpoint.loader.addScriptToPage("/_layouts/15/SP.RequestExecutor.js"),ExecuteOrDelayUntilScriptLoaded(a,"SP.RequestExecutor.js")):ExecuteOrDelayUntilScriptLoaded(a,"sp.js"),window[f].updateItem=c,window[f].updateItemUrl=d,window[f].createItem=b,window[e].items=window[f]}(),function(){function a(a,b,c){var d=blingpointWeb.get_siteGroups();blingpointContext.load(d),blingpointContext.executeQueryAsync(function(){var e;e=blingpoint.global.isNumber(a)?d.getById(a):d.getByName(a);var f=e.get_users();blingpointContext.load(f),blingpointContext.executeQueryAsync(function(){for(var a=f.getEnumerator();a.moveNext();){var d=a.get_current();if(d.get_id()==user.get_id())return b(),void 0}c()},function(a,b){blingpoint.log.warn("Request failed. "+b.get_message()+"\n"+b.get_stackTrace())})},function(a,b){blingpoint.log.warn("Request failed. "+b.get_message()+"\n"+b.get_stackTrace())})}var b="blingpoint",c="security";window[c]={},window[c].currentUserIsUserMemberOf=a,window[b].security=window[c]}(),function(){function a(a,b){ExecuteOrDelayUntilScriptLoaded(function(){return notificationId=SP.UI.Notify.addNotification(a,b),log.debug(notificationId),notificationId},"sp.js")}function b(a){SP.UI.Notify.removeNotification(a)}function c(a,b){return statusId=SP.UI.Status.addStatus(a),SP.UI.Status.setStatusPriColor(statusId,b),log.debug(statusId),statusId}function d(a){SP.UI.Status.removeStatus(a)}function e(){SP.UI.Status.removeAllStatus(!0)}function f(a,b,c){ExecuteOrDelayUntilScriptLoaded(function(){var d=SP.UI.$create_DialogOptions();d.url=a,d.width=b,d.height=c,d.dialogReturnValueCallback=function(a){a===SP.UI.DialogResult.OK&&(console.log("OK was clicked!"),blingpoint.ui.addNotification("New leave application request submitted",!1)),a===SP.UI.DialogResult.cancel&&console.log("Cancel was clicked!")},SP.UI.ModalDialog.showModalDialog(d)},"sp.js")}var g="blingpoint",h="ui";window[h]={},window[h].addStatus=c,window[h].removeStatus=d,window[h].removeAllStatus=e,window[h].addNotification=a,window[h].removeNotification=b,window[h].openDialog=f,window[g].ui=window[h]}(),function(){function a(){function a(){b()}function b(){$p.schema.createList("BlingPointPlugIns",SP.ListTemplateType.genericList,!1,c,null)}function c(){$p.schema.createContentTypeInHost("BlingPointPlugIn","BlingPoint PlugIn","BlingPointContentTypes",d,null)}function d(){$p.schema.createField("Text","PlugInDescription","PlugIn Description","BlingPointFields",!1,e,null)}function e(){$p.schema.createField("Text","PlugInUrlTrigger","PlugIn URL Trigger","BlingPointFields",!1,f,null)}function f(){$p.schema.createField("Text","PlugInSourceUrl","PlugIn Source URL","BlingPointFields",!1,g,null)}function g(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInDescription",h,null)}function h(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInUrlTrigger",i,null)}function i(){$p.schema.addFieldToContentTypeInHost("BlingPointPlugIn","PlugInSourceUrl",j,null)}function j(){$p.schema.addExistingContentTypetoList("BlingPointPlugIns","BlingPointPlugIn",k,null)}function k(){$p.schema.createList("BlingPointAssets",SP.ListTemplateType.documentLibrary,!1,null,null)}a()}function b(){BlingPointDevMode===!0&&blingpoint.log.profile("pluginsLoading");var a=blingpointWeb.get_lists().getByTitle("BlingPointPlugIns"),b=new SP.CamlQuery,c="<View><RowLimit>500</RowLimit></View>";b.set_viewXml(c);var d=a.getItems(b);blingpointContext.load(d,"Include(DisplayName,Id,PlugInSource,UrlTrigger)"),blingpointContext.executeQueryAsync(function(){for(var a=d.getEnumerator();a.moveNext();){var b=a.get_current(),c=b.get_displayName(),e=b.get_id(),f=b.get_item("PlugInSource"),g=b.get_item("UrlTrigger");log.debug("Checking PlugIn : "+c),log.debug("PlugIn ID : "+e),log.debug("PlugIn URL Trigger : "+g),blingpoint.global.checkUrl(g)&&(blingpoint.global.check(f,".js")&&(log.info("Loading PlugIn : "+c),blingpoint.loader.addScriptToPage(f)),blingpoint.global.check(f,".css")&&(log.info("Loading PlugIn : "+c),blingpoint.loader.addCssToPage(f)))}BlingPointDevMode===!0&&blingpoint.log.profile("pluginsLoading")},function(a,b){BlingPointDevMode===!0&&blingpoint.log.profile("pluginsLoading"),blingpoint.log.error("request failed "+b.get_message()+"\n"+b.get_stackTrace()),blingpoint.log.error('If the list BlingPointPlugIns does not exist, <a href="javascript:$p.plugins.setupPlugInSystem();">click here to setup BlingPoint !</a>')})}var c="blingpoint",d="plugins";window[d]={},window[d].loadPlugIns=b,window[d].setupPlugInSystem=a,window[c].plugins=window[d]}(),function(){function a(a,b){var c=blingpointWeb.get_allProperties();c.set_item(a,b),blingPointWeb.update(),blingpointContext.executeQueryAsync(function(){blingpoint.log.debug("WebSite property "+a+" = "+b)},function(a,b){blingpoint.log.warn("Request failed. "+b.get_message()+"\n"+b.get_stackTrace())})}function b(a,b){var c=blingpointWeb.get_allProperties(),d=c.get_item(a);blingpointContext.executeQueryAsync(function(){b(d)},function(a,b){blingpoint.log.warn("Request failed. "+b.get_message()+"\n"+b.get_stackTrace())})}var c="blingpoint",d="parameters";window[d]={},window[d].setWebSiteProperty=a,window[d].getWebSiteProperty=b,window[c].parameters=window[d]}();